<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Video Downloader </title>
<style>
body {
  background:#0f1724;
  color:#e6eef6;
  font-family:system-ui,sans-serif;
  display:flex;flex-direction:column;align-items:center;
  padding:20px;
}
.card {
  background:#1e293b;
  border-radius:12px;
  padding:16px;
  width:90%;max-width:600px;
  box-shadow:0 4px 20px rgba(0,0,0,0.4);
}
input,button {
  padding:10px;border-radius:8px;border:none;margin:6px 0;
}
input[type=text] {
  width:90%;background:#1e293b;color:#fff;border:1px solid #334155;
}
button {background:#06b6d4;color:#042a2f;font-weight:bold;cursor:pointer;}
#result{margin-top:20px;text-align:center;}
a.download{
  display:inline-block;background:#0ea5a5;padding:10px 14px;
  border-radius:8px;text-decoration:none;color:#042a2f;font-weight:700;
}
</style>
</head>
<body>

<div class="card">
  <h2>Simple Video Downloader</h2>
  <p>Enter a page URL:</p>
  <input id="pageUrl" type="text" placeholder="https://example.com/video-page" />
  <button id="fetchBtn">Fetch Video</button>
  <div id="status"></div>
  <div id="result"></div>
</div>

<script>
const fetchBtn = document.getElementById('fetchBtn');
const pageUrlInput = document.getElementById('pageUrl');
const resultEl = document.getElementById('result');
const statusEl = document.getElementById('status');

fetchBtn.addEventListener('click', async () => {
  const url = pageUrlInput.value.trim();
  if (!url) return alert("Enter a URL");

  statusEl.textContent = "Fetching page...";
  resultEl.innerHTML = "";

  const tryFetch = async (fetchUrl) => {
    const resp = await fetch(fetchUrl);
    if (!resp.ok) throw new Error(`Fetch failed: ${resp.status}`);
    return await resp.text();
  };

  try {
    let html;
    try {
      // Try direct fetch first
      html = await tryFetch(url);
    } catch {
      // If blocked, use public CORS proxies
      statusEl.textContent = "Direct fetch blocked — retrying via proxy...";
      try {
        html = await tryFetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
      } catch {
        html = await tryFetch(`https://corsproxy.io/?${encodeURIComponent(url)}`);
      }
    }

    // parse and find videos
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, "text/html");
    const candidates = [];

    doc.querySelectorAll("video").forEach(v=>{
      const src = v.getAttribute("src");
      if (src) candidates.push(new URL(src, url).href);
      v.querySelectorAll("source").forEach(s=>{
        const ssrc = s.getAttribute("src");
        if (ssrc) candidates.push(new URL(ssrc, url).href);
      });
    });

    const regex = /(https?:\/\/[^\s"'<>]+?\.(mp4|m3u8|webm)[^\s"'<>]*)/gi;
    const matches = html.match(regex) || [];
    matches.forEach(m=>candidates.push(m));

    const unique = [...new Set(candidates)];
    if (unique.length===0) {
      resultEl.innerHTML="<p>No video links found on this page.</p>";
      statusEl.textContent="Done (no video)";
      return;
    }

    const main=unique[0];
    resultEl.innerHTML=`
      <p><strong>Found Video:</strong></p>
      <p style="word-break:break-all;">${main}</p>
      <a href="${main}" class="download" target="_blank" rel="noopener noreferrer">Download Video</a>
    `;
    statusEl.textContent="Video ready for download ✅";
  } catch(err) {
    statusEl.textContent="Error: "+err.message;
    resultEl.innerHTML=`<p>Error: ${err.message}</p>`;
  }
});
</script>
</body>
</html>